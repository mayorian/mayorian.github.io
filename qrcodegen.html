<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
    crossorigin="anonymous"
  />

  <!-- Your QR lib(s) -->
  <script src="qrgen.js"></script>

  <title>QR Generator</title>

  <style>
    :root{
      --bg1:#05010f;
      --bg2:#060b2a;
      --neon:#00e5ff;
      --neon2:#b500ff;
      --good:#2eff9b;
      --warn:#ffd56a;
      --bad:#ff5c7a;
      --glass: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.16);
      --text: rgba(255,255,255,.90);
      --muted: rgba(255,255,255,.62);
    }

    body{
      min-height: 100vh;
      color: var(--text);
      background:
        radial-gradient(1000px 600px at 15% 20%, rgba(181,0,255,.25), transparent 60%),
        radial-gradient(1000px 600px at 85% 30%, rgba(0,229,255,.22), transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      overflow-x: hidden;
    }

    .grid-bg{
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: .22;
      background:
        linear-gradient(to right, rgba(255,255,255,.06) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.06) 1px, transparent 1px);
      background-size: 46px 46px;
      mask-image: radial-gradient(circle at 50% 20%, black 0%, transparent 65%);
      animation: drift 18s linear infinite;
    }
    @keyframes drift { to { transform: translate3d(-46px,-46px,0); } }

    .scanline{
      position: fixed;
      left: 0;
      right: 0;
      top: -30%;
      height: 220px;
      background: linear-gradient(to bottom, transparent, rgba(0,229,255,.12), transparent);
      filter: blur(2px);
      animation: scan 7s ease-in-out infinite;
      pointer-events: none;
      opacity: .65;
    }
    @keyframes scan{
      0%{ transform: translateY(-40vh); }
      50%{ transform: translateY(60vh); }
      100%{ transform: translateY(-40vh); }
    }

    .brandbar{
      border-bottom: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.15);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .glass{
      background: var(--glass);
      border: 1px solid var(--stroke);
      border-radius: 22px;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow:
        0 20px 60px rgba(0,0,0,.35),
        inset 0 1px 0 rgba(255,255,255,.10);
    }

    .hero-title{
      letter-spacing: .02em;
      text-shadow: 0 0 26px rgba(0,229,255,.18);
    }

    .subtle{ color: var(--muted); }

    .form-control, .form-select, .form-control:focus, .form-select:focus{
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.18);
      color: var(--text);
      border-radius: 14px;
      box-shadow: none;
    }
    .form-control::placeholder{ color: rgba(255,255,255,.40); }

    .input-group-text{
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.18);
      color: rgba(255,255,255,.70);
      border-radius: 14px;
    }

    input[type="color"]{
      padding: 6px;
      height: 44px;
      cursor: pointer;
    }

    .btn-neon{
      border: 1px solid rgba(0,229,255,.55);
      background: linear-gradient(135deg, rgba(0,229,255,.20), rgba(181,0,255,.15));
      color: var(--text);
      border-radius: 16px;
      transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
    }
    .btn-neon:hover{
      transform: translateY(-1px);
      border-color: rgba(0,229,255,.85);
      box-shadow: 0 10px 34px rgba(0,229,255,.12);
      color: white;
    }

    .btn-alt{
      border: 1px solid rgba(46,255,155,.45);
      background: linear-gradient(135deg, rgba(46,255,155,.18), rgba(0,229,255,.10));
      color: var(--text);
      border-radius: 16px;
    }

    .btn-ghost{
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.12);
      color: var(--text);
      border-radius: 16px;
    }

    .pill{
      display: inline-flex;
      gap: 10px;
      align-items: center;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.78);
      font-size: .9rem;
    }

    .status{
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      font-size: .92rem;
      color: rgba(255,255,255,.78);
    }
    .status.good{ border-color: rgba(46,255,155,.35); }
    .status.warn{ border-color: rgba(255,213,106,.35); }
    .status.bad{ border-color: rgba(255,92,122,.35); }

    /* QR output box */
    #qrcodeWrap{
      display: grid;
      gap: 14px;
    }
    #qrcode{
      display: grid;
      place-items: center;
      padding: 18px;
      border-radius: 22px;
      border: 1px dashed rgba(255,255,255,.22);
      background: rgba(0,0,0,.16);
      min-height: 180px;
    }
    #qrcode img, #qrcode canvas{
      max-width: 100%;
      height: auto;
      border-radius: 14px;
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
    }

    .tiny{
      font-size: .85rem;
      color: rgba(255,255,255,.55);
    }

    .divider{
      height: 1px;
      background: rgba(255,255,255,.12);
      margin: 18px 0;
    }

    .preset{
      cursor: pointer;
      border-radius: 999px;
      padding: 8px 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      color: rgba(255,255,255,.78);
      user-select: none;
      transition: transform .08s ease, border-color .12s ease;
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }
    .preset:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.24); }
    .dot{
      width: 12px; height: 12px; border-radius: 50%;
      box-shadow: 0 0 18px rgba(255,255,255,.12);
    }

    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: .85rem;
      padding: 3px 8px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.75);
    }
  </style>
</head>

<body>
  <div class="grid-bg"></div>
  <div class="scanline"></div>

  <!-- Brand -->
  <header class="brandbar py-3">
    <div class="container d-flex align-items-center justify-content-between gap-3">
      <img
        src="https://cdn.glitch.global/f72ae212-6431-4b90-a4d7-c9bfb3746064/jsmayo%20copy.jpg?v=1659050284269"
        alt="JSmayo"
        width="250" height="80"
        style="object-fit:contain; filter: drop-shadow(0 8px 18px rgba(0,229,255,.10));"
      />

      <span class="pill">
        <span style="width:10px;height:10px;border-radius:50%;background:var(--neon);box-shadow:0 0 18px rgba(0,229,255,.55)"></span>
        Live QR Console
      </span>
    </div>
  </header>

  <main class="container py-5">
    <div class="row g-4 align-items-stretch">
      <!-- Controls -->
      <div class="col-12 col-lg-6">
        <div class="glass p-4 p-md-5 h-100">
          <h1 class="display-5 fw-bold hero-title mb-2">QR Code Generator</h1>
          <p class="lead subtle mb-4">
            Live preview, presets, ECC control, margin, transparency, and PNG export.
          </p>

          <div class="mb-3">
            <label for="inputURL" class="form-label subtle">URL / Text / Number</label>
            <input
              id="inputURL"
              name="inputURL"
              type="text"
              class="form-control"
              placeholder="https://mayorian.github.io/"
              value="https://mayorian.github.io/"
              autocomplete="off"
            />
            <div class="tiny mt-2">
              Tip: Press <span class="kbd">Ctrl</span> + <span class="kbd">Enter</span> to force-generate.
            </div>
          </div>

          <div class="d-flex flex-wrap gap-2 mb-3">
            <div class="preset" onclick="applyPreset('cyber')">
              <span class="dot" style="background:#00e5ff"></span> Cyber Blue
            </div>
            <div class="preset" onclick="applyPreset('magenta')">
              <span class="dot" style="background:#b500ff"></span> Magenta
            </div>
            <div class="preset" onclick="applyPreset('lime')">
              <span class="dot" style="background:#2eff9b"></span> Lime
            </div>
            <div class="preset" onclick="applyPreset('classic')">
              <span class="dot" style="background:#111111"></span> Classic
            </div>
          </div>

          <div class="row g-3">
            <div class="col-6">
              <label for="inputWidth" class="form-label subtle">Width (px)</label>
              <input id="inputWidth" type="number" min="64" max="2048" class="form-control" value="640" />
            </div>
            <div class="col-6">
              <label for="inputHeight" class="form-label subtle">Height (px)</label>
              <input id="inputHeight" type="number" min="64" max="2048" class="form-control" value="640" />
            </div>

            <div class="col-6">
              <label for="inputColorDark" class="form-label subtle">QR Color (dark)</label>
              <input id="inputColorDark" type="color" class="form-control form-control-color" value="#00e5ff" />
            </div>
            <div class="col-6">
              <label for="inputColorLight" class="form-label subtle">Background (light)</label>
              <input id="inputColorLight" type="color" class="form-control form-control-color" value="#ffffff" />
            </div>

            <div class="col-6">
              <label for="inputECC" class="form-label subtle">Error correction</label>
              <select id="inputECC" class="form-select">
                <option value="L">L (7%)</option>
                <option value="M">M (15%)</option>
                <option value="Q">Q (25%)</option>
                <option value="H" selected>H (30%)</option>
              </select>
            </div>

            <div class="col-6">
              <label for="inputMargin" class="form-label subtle">Margin / Quiet zone</label>
              <input id="inputMargin" type="number" min="0" max="40" class="form-control" value="2" />
            </div>

            <div class="col-12">
              <div class="d-flex flex-wrap gap-3 align-items-center">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" role="switch" id="transparentBg">
                  <label class="form-check-label subtle" for="transparentBg">Transparent background</label>
                </div>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" role="switch" id="autoGenerate" checked>
                  <label class="form-check-label subtle" for="autoGenerate">Auto-generate</label>
                </div>
              </div>
              <div class="tiny mt-2">
                If transparency is enabled, background color is ignored for the exported image.
              </div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="d-flex flex-wrap gap-2">
            <button id="btnGenerate" class="btn btn-neon btn-lg px-4" type="button" onclick="generateQR(true)">
              Generate
            </button>
            <button id="btnDownload" class="btn btn-alt btn-lg px-4" type="button" onclick="downloadPNG()" disabled>
              Download PNG
            </button>
            <button class="btn btn-ghost btn-lg px-4" type="button" onclick="copyText()">
              Copy Text
            </button>
            <button class="btn btn-ghost btn-lg px-4" type="button" onclick="resetDefaults()">
              Reset
            </button>
          </div>

          <div id="status" class="status mt-4">
            Ready. Start typing — preview will update automatically.
          </div>
        </div>
      </div>

      <!-- Output -->
      <div class="col-12 col-lg-6">
        <div class="glass p-4 p-md-5 h-100">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <h2 class="h4 mb-0">Output</h2>
            <span class="pill">
              <span style="width:10px;height:10px;border-radius:50%;background:var(--good);box-shadow:0 0 18px rgba(46,255,155,.45)"></span>
              Live Preview
            </span>
          </div>

          <div id="qrcodeWrap">
            <div id="qrcode"></div>
            <div class="tiny">
              If scanning fails: increase margin, choose darker color, or raise ECC to <b>H</b>.
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Bootstrap Bundle -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"
  ></script>

  <script>
    // ---------- Helpers ----------
    const $ = (id) => document.getElementById(id);

    function setStatus(kind, msg){
      const el = $("status");
      el.className = "status " + (kind || "");
      el.textContent = msg;
    }

    function debounce(fn, delay=200){
      let t = null;
      return (...args) => {
        clearTimeout(t);
        t = setTimeout(() => fn(...args), delay);
      };
    }

    function eccFromSelect(val){
      // QRCode lib typically exposes QRCode.CorrectLevel.{L,M,Q,H}
      switch(val){
        case "L": return QRCode.CorrectLevel.L;
        case "M": return QRCode.CorrectLevel.M;
        case "Q": return QRCode.CorrectLevel.Q;
        default: return QRCode.CorrectLevel.H;
      }
    }

    function clamp(n, min, max){
      n = Number(n);
      if (Number.isNaN(n)) return min;
      return Math.max(min, Math.min(max, n));
    }

    // ---------- Presets ----------
    function applyPreset(name){
      if (name === "cyber"){
        $("inputColorDark").value = "#00e5ff";
        $("inputColorLight").value = "#ffffff";
        $("transparentBg").checked = false;
        $("inputECC").value = "H";
        $("inputMargin").value = 2;
      } else if (name === "magenta"){
        $("inputColorDark").value = "#b500ff";
        $("inputColorLight").value = "#ffffff";
        $("transparentBg").checked = false;
        $("inputECC").value = "H";
        $("inputMargin").value = 3;
      } else if (name === "lime"){
        $("inputColorDark").value = "#2eff9b";
        $("inputColorLight").value = "#0b1020";
        $("transparentBg").checked = false;
        $("inputECC").value = "Q";
        $("inputMargin").value = 3;
      } else if (name === "classic"){
        $("inputColorDark").value = "#111111";
        $("inputColorLight").value = "#ffffff";
        $("transparentBg").checked = false;
        $("inputECC").value = "M";
        $("inputMargin").value = 2;
      }
      generateQR(false);
    }

    function resetDefaults(){
      $("inputURL").value = "https://mayorian.github.io/";
      $("inputWidth").value = 640;
      $("inputHeight").value = 640;
      $("inputColorDark").value = "#00e5ff";
      $("inputColorLight").value = "#ffffff";
      $("inputECC").value = "H";
      $("inputMargin").value = 2;
      $("transparentBg").checked = false;
      $("autoGenerate").checked = true;
      $("btnDownload").disabled = true;
      $("qrcode").innerHTML = "";
      setStatus("", "Reset done. Start typing — preview will update automatically.");
      generateQR(false);
    }

    // ---------- QR Generation ----------
    function generateQR(force){
      const auto = $("autoGenerate").checked;
      if (!force && !auto) return;

      const text = $("inputURL").value.trim();
      const w = clamp($("inputWidth").value, 64, 2048);
      const h = clamp($("inputHeight").value, 64, 2048);
      const dark = $("inputColorDark").value || "#00e5ff";
      const light = $("inputColorLight").value || "#ffffff";
      const ecc = eccFromSelect($("inputECC").value);
      const margin = clamp($("inputMargin").value, 0, 40);
      const transparent = $("transparentBg").checked;

      // Basic validation
      if (!text){
        $("qrcode").innerHTML = "";
        $("btnDownload").disabled = true;
        setStatus("warn", "Enter some text/URL to generate a QR.");
        return;
      }
      if (w < 64 || h < 64){
        setStatus("bad", "Width/Height too small. Minimum is 64px.");
        return;
      }

      // Clear previous QR
      const qrEl = $("qrcode");
      qrEl.innerHTML = "";

      try{
        // Some QR libs support "margin". If yours doesn't, it will be ignored safely.
        new QRCode(qrEl, {
          text,
          width: w,
          height: h,
          colorDark: dark,
          colorLight: transparent ? "rgba(0,0,0,0)" : light,
          correctLevel: ecc,
          margin: margin
        });

        $("btnDownload").disabled = false;

        // Status guidance
        let hint = "Generated.";
        if (text.length > 120) hint = "Generated. Long payload — consider ECC=H and larger size.";
        if (margin < 2) hint = "Generated. If scanning fails, increase margin (quiet zone).";

        setStatus("good", `${hint} Size: ${w}×${h}px • ECC: ${$("inputECC").value} • Margin: ${margin}${transparent ? " • Transparent" : ""}`);
      }catch(err){
        $("btnDownload").disabled = true;
        setStatus("bad", "Generation failed. Check your QR library is loaded and compatible.");
        console.error(err);
      }
    }

    const generateDebounced = debounce(() => generateQR(false), 200);

    // ---------- Download ----------
    function downloadPNG(){
      const qrEl = $("qrcode");
      const canvas = qrEl.querySelector("canvas");
      const img = qrEl.querySelector("img");

      // Prefer canvas
      if (canvas && canvas.toDataURL){
        const a = document.createElement("a");
        a.download = "qr.png";
        a.href = canvas.toDataURL("image/png");
        a.click();
        setStatus("good", "Downloaded PNG from canvas.");
        return;
      }

      // If the library renders an <img> with a data URL
      if (img && img.src && img.src.startsWith("data:image")){
        const a = document.createElement("a");
        a.download = "qr.png";
        a.href = img.src;
        a.click();
        setStatus("good", "Downloaded PNG from image data.");
        return;
      }

      setStatus("warn", "Download not available. Your QR library didn't output a canvas or data image.");
    }

    // ---------- Copy ----------
    async function copyText(){
      const text = $("inputURL").value;
      try{
        await navigator.clipboard.writeText(text);
        setStatus("good", "Copied input text to clipboard.");
      }catch(e){
        // Fallback
        const tmp = document.createElement("textarea");
        tmp.value = text;
        document.body.appendChild(tmp);
        tmp.select();
        document.execCommand("copy");
        document.body.removeChild(tmp);
        setStatus("good", "Copied input text (fallback).");
      }
    }

    // ---------- Events ----------
    ["inputURL","inputWidth","inputHeight","inputColorDark","inputColorLight","inputECC","inputMargin","transparentBg","autoGenerate"]
      .forEach(id => $(id).addEventListener("input", generateDebounced));

    // Force-generate shortcut
    window.addEventListener("keydown", (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter"){
        generateQR(true);
      }
    });

    // Initial generate
    window.addEventListener("load", () => generateQR(true));
  </script>
</body>
</html>
