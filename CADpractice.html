<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CAD Practice</title>

  <style>
      /* Modern white/blue UI */
      :root {
          --blue-600: #2563eb;
          --blue-700: #1d4ed8;
          --blue-800: #1e40af;
          --bg: #f6f8fc;
          --card: #ffffff;
          --border: #e5e7eb;
          --text: #0f172a;
          --muted: #64748b;
          --hover: #eff6ff;
          --focus: rgba(37, 99, 235, .18);
          --success-bg: #ecfdf3;
          --success-border: #22c55e;
          --shadow: 0 10px 30px rgba(15, 23, 42, .08);
          --shadow-sm: 0 2px 10px rgba(15, 23, 42, .06);
          --radius: 14px;
          --radius-sm: 10px;
      }

      * {
          box-sizing: border-box;
      }

      body {
          font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
          background: radial-gradient(1200px 500px at 20% -10%, rgba(37,99,235,.10), transparent 60%), radial-gradient(900px 500px at 90% 0%, rgba(37,99,235,.08), transparent 55%), var(--bg);
          color: var(--text);
          margin: 0;
          padding: 28px 18px;
          line-height: 1.45;
      }

      .wrap {
          max-width: 1020px;
          margin: 0 auto;
      }

      /* Header bar */
      .header {
          background: linear-gradient(135deg, var(--blue-700), var(--blue-600));
          color: #fff;
          padding: 16px 18px;
          border-radius: var(--radius);
          margin-bottom: 14px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 12px;
          box-shadow: var(--shadow);
      }

          .header h1 {
              margin: 0;
              font-size: 18px;
              font-weight: 800;
              letter-spacing: .2px;
          }

          .header .sub {
              font-size: 12px;
              opacity: .95;
              text-align: right;
              white-space: nowrap;
          }

      /* L2 header */
      .l2_header {
          background: #ffffff;
          border: 1px solid var(--border);
          color: var(--text);
          padding: 12px 14px;
          border-radius: var(--radius);
          margin-bottom: 14px;
          display: flex;
          align-items: center;
          gap: 10px;
          flex-wrap: wrap;
          box-shadow: var(--shadow-sm);
      }

          .l2_header b {
              margin-right: 6px;
              color: var(--muted);
              font-size: 13px;
              font-weight: 700;
          }

      .muted {
          color: var(--muted);
          font-size: 13px;
      }

      /* Category + Search bar */
      .filters {
          background: var(--card);
          border: 1px solid var(--border);
          padding: 12px;
          border-radius: var(--radius);
          margin-bottom: 16px;
          display: flex;
          gap: 10px;
          flex-wrap: wrap;
          align-items: center;
          box-shadow: var(--shadow-sm);
      }

          .filters .label {
              font-size: 13px;
              color: var(--muted);
              margin-right: 2px;
              font-weight: 600;
          }

      #categoryButtons {
          display: flex;
          gap: 8px;
          flex-wrap: wrap;
          align-items: center;
      }

      .search {
          margin-left: auto;
          display: flex;
          gap: 8px;
          align-items: center;
          flex-wrap: wrap;
      }

      input[type="search"] {
          border: 1px solid var(--border);
          border-radius: 999px;
          padding: 10px 12px;
          min-width: 260px;
          outline: none;
          background: #fff;
          color: var(--text);
          box-shadow: 0 1px 0 rgba(15,23,42,.03);
          transition: .15s ease;
      }

          input[type="search"]::placeholder {
              color: rgba(100,116,139,.85);
          }

          input[type="search"]:focus {
              border-color: rgba(37,99,235,.55);
              box-shadow: 0 0 0 4px var(--focus);
          }

      /* Buttons */
      button {
          background: #ffffff;
          border: 1px solid var(--border);
          color: var(--text);
          padding: 9px 14px;
          border-radius: 999px;
          font-weight: 700;
          cursor: pointer;
          transition: .15s ease;
          box-shadow: 0 1px 0 rgba(15,23,42,.03);
      }

          button:hover {
              background: var(--hover);
              border-color: rgba(37,99,235,.35);
              transform: translateY(-1px);
          }

          button:active {
              transform: translateY(0px);
          }

          button.active {
              background: linear-gradient(135deg, var(--blue-700), var(--blue-600));
              color: white;
              border-color: rgba(255,255,255,.2);
              box-shadow: 0 10px 20px rgba(37,99,235,.18);
          }

          button.small {
              padding: 8px 12px;
              font-size: 12px;
          }

      /* Make Shuffle stand out slightly */
      #shuffleBtn {
          border-color: rgba(37,99,235,.25);
      }

          #shuffleBtn:hover {
              border-color: rgba(37,99,235,.45);
          }

      /* Question card */
      .card {
          background: var(--card);
          border: 1px solid var(--border);
          border-radius: var(--radius);
          padding: 18px;
          margin-bottom: 16px;
          box-shadow: var(--shadow-sm);
      }

      .qhead {
          display: flex;
          gap: 12px;
          align-items: flex-start;
          justify-content: space-between;
      }

      .qtitle {
          font-size: 16px;
          font-weight: 700;
          margin: 0;
          line-height: 1.4;
          flex: 1;
      }

          .qtitle strong {
              color: var(--blue-800);
          }

      .pill {
          background: rgba(37,99,235,.08);
          border: 1px solid rgba(37,99,235,.18);
          color: var(--blue-800);
          font-size: 12px;
          border-radius: 999px;
          padding: 6px 10px;
          white-space: nowrap;
          font-weight: 700;
      }

      /* Answers */
      .answers {
          margin-top: 14px;
          display: grid;
          gap: 10px;
      }

      .ans {
          display: flex;
          gap: 12px;
          align-items: flex-start;
          border: 1px solid var(--border);
          border-radius: var(--radius-sm);
          padding: 12px 12px;
          background: white;
          transition: .15s ease;
      }

          .ans:hover {
              border-color: rgba(37,99,235,.35);
              background: var(--hover);
          }

          .ans code {
              font-weight: 900;
              color: var(--blue-800);
              background: rgba(37,99,235,.08);
              border: 1px solid rgba(37,99,235,.15);
              padding: 2px 8px;
              border-radius: 999px;
              line-height: 1.6;
          }

          /* Correct highlight */
          .ans.correct {
              background: var(--success-bg);
              border-color: var(--success-border);
          }

      .btnrow {
          margin-top: 14px;
          display: flex;
          gap: 10px;
          flex-wrap: wrap;
          align-items: center;
      }

      .empty {
          background: #fff;
          border: 1px dashed var(--border);
          border-radius: var(--radius);
          padding: 18px;
          box-shadow: var(--shadow-sm);
      }

      /* Small responsive tweak */
      @media (max-width: 520px) {
          input[type="search"] {
              min-width: 100%;
          }

          .search {
              margin-left: 0;
              width: 100%;
          }
      }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="header">
      <h1>CAD</h1>
      <div class="sub">
        ServiceNow Exam Practice<br/>
        <span id="counts">0 questions</span>
      </div>
    </div>

    <div class="filters">
      <span class="label">Category:</span>
      <div id="categoryButtons"></div>

      <button id="shuffleBtn" type="button">ðŸ”€ Shuffle Questions</button>

      <div class="search">
        <span class="label">Search:</span>
        <input id="searchBox" type="search" placeholder="Type to filter questions..." />
        <button id="clearSearchBtn" class="small" type="button">Clear</button>
      </div>
    </div>

    <div id="questionsRoot" aria-live="polite"></div>

  </div>
  <!-- Questions bank -->
  <script src="https://cdn.jsdelivr.net/gh/mayorian/qeustion-bank-exam1@dev/bank_practice.js"></script>
  <script>
    // =========================
    // 1) QUESTION BANK (EDIT ME)
    // ==========================

    // =========================
    // 2) HELPERS
    // =========================
    function parseRightAnswers(rightAnswersStr) {
      return new Set(
        String(rightAnswersStr || "")
          .split(",")
          .map(s => s.trim().toLowerCase())
          .filter(Boolean)
      );
    }

    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, m => ({
        "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;"
      }[m]));
    }

    function normalizeCategory(c) {
      var v = (c ?? "Uncategorized").toString().trim();
      return v ? v : "Uncategorized";
    }

    function getCategories(questions) {
      var seen = new Set();
      var cats = [];
      questions.forEach(q => {
        var c = normalizeCategory(q.category);
        if (!seen.has(c)) { seen.add(c); cats.push(c); }
      });
      return cats;
    }

    function questionMatchesSearch(q, term) {
      if (!term) return true;
      var t = term.toLowerCase();

      var inQuestion = String(q.question || "").toLowerCase().includes(t);
      var inCategory = normalizeCategory(q.category).toLowerCase().includes(t);

      var ansObj = q.answers || {};
      var inAnswers = Object.keys(ansObj).some(k => String(ansObj[k]).toLowerCase().includes(t));

      return inQuestion || inCategory || inAnswers;
    }

    function answerCountLabel(rightSet) {
      // When multiple answers, show number like 2, 3...
      // When single, show 1
      return rightSet.size + (rightSet.size === 1 ? " answer" : " answers");
    }

    // =========================
    // 3) RENDER QUESTIONS
    // =========================
    function renderQuestions(questions, rootEl) {
      rootEl.innerHTML = "";

      if (!questions.length) {
        rootEl.innerHTML = '<div class="empty muted">No questions match this filter.</div>';
        return;
      }

      questions.forEach((q, idx) => {
        var card = document.createElement("section");
        card.className = "card";
        card.setAttribute("data-category", normalizeCategory(q.category));

        var rightSet = parseRightAnswers(q.rightAnswers);

        // header
        var header = document.createElement("div");
        header.className = "qhead";

        var title = document.createElement("p");
        title.className = "qtitle";
        title.innerHTML = "<strong>Q" + (idx + 1) + ".</strong> " + escapeHtml(q.question);

        var meta = document.createElement("span");
        meta.className = "pill";
        // âœ… category + number of correct answers (2, 3...)
        meta.textContent = normalizeCategory(q.category) + " â€¢ " + answerCountLabel(rightSet);

        header.appendChild(title);
        header.appendChild(meta);

        // answers
        var answersWrap = document.createElement("div");
        answersWrap.className = "answers";

        var keys = Object.keys(q.answers || {}).sort((a,b) => a.localeCompare(b));
        keys.forEach((key) => {
          var row = document.createElement("div");
          row.className = "ans";
          row.setAttribute("data-option", key.toLowerCase());
          row.innerHTML =
            "<code>" + escapeHtml(key) + ".</code>" +
            "<div>" + escapeHtml(q.answers[key]) + "</div>";
          answersWrap.appendChild(row);
        });

        // buttons
        var btnRow = document.createElement("div");
        btnRow.className = "btnrow";

        var showBtn = document.createElement("button");
        showBtn.type = "button";
        showBtn.textContent = "Show right answer";
        showBtn.addEventListener("click", function () {
          card.querySelectorAll(".ans").forEach(r => {
            var opt = (r.getAttribute("data-option") || "").toLowerCase();
            r.classList.toggle("correct", rightSet.has(opt));
          });
        });

        var clearBtn = document.createElement("button");
        clearBtn.type = "button";
        clearBtn.textContent = "Clear highlight";
        clearBtn.addEventListener("click", function () {
          card.querySelectorAll(".ans.correct").forEach(r => r.classList.remove("correct"));
        });

        btnRow.appendChild(showBtn);
        btnRow.appendChild(clearBtn);

        card.appendChild(header);
        card.appendChild(answersWrap);
        card.appendChild(btnRow);

        rootEl.appendChild(card);
      });
    }

    // =========================
    // 4) CATEGORY BUTTONS + FILTERING + SHUFFLE
    // =========================
    var state = {
      selectedCategory: "__ALL__",
      searchTerm: ""
    };

    function shuffleQuestions() {
      for (let i = questionsBankArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [questionsBankArray[i], questionsBankArray[j]] = [questionsBankArray[j], questionsBankArray[i]];
      }
    }

    function applyFiltersAndRender() {
      var filtered = questionsBankArray
        .filter(q => state.selectedCategory === "__ALL__" || normalizeCategory(q.category) === state.selectedCategory)
        .filter(q => questionMatchesSearch(q, state.searchTerm));

      // Update header counts
      var total = questionsBankArray.length;
      var shown = filtered.length;
      document.getElementById("counts").textContent = shown + " / " + total + " questions";

      renderQuestions(filtered, document.getElementById("questionsRoot"));
    }

    function buildCategoryButtons(categories, containerEl) {
      containerEl.innerHTML = "";

      function makeBtn(label, value) {
        var b = document.createElement("button");
        b.type = "button";
        b.textContent = label;
        b.setAttribute("data-cat", value);
        b.addEventListener("click", function () {
          // Only remove active from category buttons (not from Shuffle/Clear/Search buttons)
          containerEl.querySelectorAll("button").forEach(x => x.classList.remove("active"));
          b.classList.add("active");

          state.selectedCategory = value;
          applyFiltersAndRender();
        });
        return b;
      }

      // All button
      var allBtn = makeBtn("All", "__ALL__");
      allBtn.classList.add("active");
      containerEl.appendChild(allBtn);

      // Category buttons
      categories.forEach(cat => containerEl.appendChild(makeBtn(cat, cat)));
    }

    // =========================
    // 5) INIT
    // =========================
    (function init(){
      var cats = getCategories(questionsBankArray);
      buildCategoryButtons(cats, document.getElementById("categoryButtons"));

      // Search
      var searchBox = document.getElementById("searchBox");
      searchBox.addEventListener("input", function(){
        state.searchTerm = searchBox.value || "";
        applyFiltersAndRender();
      });

      document.getElementById("clearSearchBtn").addEventListener("click", function(){
        searchBox.value = "";
        state.searchTerm = "";
        applyFiltersAndRender();
        searchBox.focus();
      });

      // Shuffle
      document.getElementById("shuffleBtn").addEventListener("click", function(){
        shuffleQuestions();
        applyFiltersAndRender();
      });

      applyFiltersAndRender();
    })();
  </script>
</body>
</html>
